<!doctype html><html lang=zh-CN><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><title>Arduino 101 GPIO 实现详解 - Wishlily's blog</title><meta name=Description content="Arduino 101 GPIO 实现详解"><meta property="og:url" content="https://wishlily.github.io/article/2017/04/20/arduino-101-gpio-implementation-details/">
<meta property="og:site_name" content="Wishlily's blog"><meta property="og:title" content="Arduino 101 GPIO 实现详解"><meta property="og:description" content="Arduino 101 GPIO 实现详解"><meta property="og:locale" content="zh_CN"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2017-04-20T15:52:30+00:00"><meta property="article:modified_time" content="2017-04-20T15:52:30+00:00"><meta property="article:tag" content="Arduino"><meta property="article:tag" content="Quark"><meta property="article:tag" content="Gpio"><meta property="og:image" content="https://wishlily.github.io/favicon.png"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://wishlily.github.io/favicon.png"><meta name=twitter:title content="Arduino 101 GPIO 实现详解"><meta name=twitter:description content="Arduino 101 GPIO 实现详解"><meta name=application-name content="Wishlily's blog"><meta name=apple-mobile-web-app-title content="Wishlily's blog"><meta name=theme-color content="#ffffff"><meta name=msapplication-TileColor content="#da532c"><link rel=icon href=/favicon.svg><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=manifest href=/site.webmanifest><link rel=canonical href=https://wishlily.github.io/article/2017/04/20/arduino-101-gpio-implementation-details/><link rel=prev href=https://wishlily.github.io/article/2017/04/07/sierpinski-triangle/><link rel=next href=https://wishlily.github.io/article/2017/06/15/gcc/><link rel=stylesheet href=/css/style.min.css><link rel=preload href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css as=style onload='this.onload=null,this.rel="stylesheet"'><noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css></noscript><link rel=preload href=https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css as=style onload='this.onload=null,this.rel="stylesheet"'><noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css></noscript><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"Arduino 101 GPIO 实现详解","inLanguage":"zh-CN","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/wishlily.github.io\/article\/2017\/04\/20\/arduino-101-gpio-implementation-details\/"},"genre":"posts","keywords":"arduino, quark, gpio","wordcount":1550,"url":"https:\/\/wishlily.github.io\/article\/2017\/04\/20\/arduino-101-gpio-implementation-details\/","datePublished":"2017-04-20T15:52:30+00:00","dateModified":"2017-04-20T15:52:30+00:00","publisher":{"@type":"Organization","name":""},"author":{"@type":"Person","name":"Wishlily"},"description":"Arduino 101 GPIO 实现详解"}</script></head><body data-header-desktop=fixed data-header-mobile=auto><script type=text/javascript>(window.localStorage&&localStorage.getItem("theme")?localStorage.getItem("theme")==="dark":"auto"==="auto"?window.matchMedia("(prefers-color-scheme: dark)").matches:"auto"==="dark")&&document.body.setAttribute("theme","dark")</script><div id=mask></div><div class=wrapper><header class=desktop id=header-desktop><div class=header-wrapper><div class=header-title><a href=/ title="Wishlily's blog"><img class="lazyload logo" src=/svg/loading.min.svg data-src=/favicon.ico data-srcset="/favicon.ico, /favicon.ico 1.5x, /favicon.ico 2x" data-sizes=auto alt=/favicon.ico title=/favicon.ico>Wishlily's blog</a></div><div class=menu><div class=menu-inner><a class=menu-item href=/posts/>文章 </a><a class=menu-item href=/tags/>标签 </a><a class=menu-item href=/categories/>分类 </a><a class=menu-item href=/series/>系列 </a><a class=menu-item href=/about/>关于 </a><span class="menu-item delimiter"></span><span class="menu-item search" id=search-desktop>
<input type=text placeholder=搜索文章标题或内容... id=search-input-desktop>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-desktop title=搜索><i class="fas fa-search fa-fw" aria-hidden=true></i>
</a><a href=javascript:void(0); class="search-button search-clear" id=search-clear-desktop title=清空><i class="fas fa-times-circle fa-fw" aria-hidden=true></i>
</a><span class="search-button search-loading" id=search-loading-desktop><i class="fas fa-spinner fa-fw fa-spin" aria-hidden=true></i>
</span></span><a href=javascript:void(0); class="menu-item theme-switch" title=切换主题><i class="fas fa-adjust fa-fw" aria-hidden=true></i></a></div></div></div></header><header class=mobile id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title="Wishlily's blog"><img class="lazyload logo" src=/svg/loading.min.svg data-src=/favicon.ico data-srcset="/favicon.ico, /favicon.ico 1.5x, /favicon.ico 2x" data-sizes=auto alt=/favicon.ico title=/favicon.ico>Wishlily's blog</a></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><div class=menu id=menu-mobile><div class=search-wrapper><div class="search mobile" id=search-mobile><input type=text placeholder=搜索文章标题或内容... id=search-input-mobile>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-mobile title=搜索><i class="fas fa-search fa-fw" aria-hidden=true></i>
</a><a href=javascript:void(0); class="search-button search-clear" id=search-clear-mobile title=清空><i class="fas fa-times-circle fa-fw" aria-hidden=true></i>
</a><span class="search-button search-loading" id=search-loading-mobile><i class="fas fa-spinner fa-fw fa-spin" aria-hidden=true></i></span></div><a href=javascript:void(0); class=search-cancel id=search-cancel-mobile>取消</a></div><a class=menu-item href=/posts/ title>文章</a><a class=menu-item href=/tags/ title>标签</a><a class=menu-item href=/categories/ title>分类</a><a class=menu-item href=/series/ title>系列</a><a class=menu-item href=/about/ title>关于</a><a href=javascript:void(0); class="menu-item theme-switch" title=切换主题>
<i class="fas fa-adjust fa-fw" aria-hidden=true></i></a></div></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><main class=main><div class=container><div class=toc id=toc-auto><h2 class=toc-title>目录</h2><div class=toc-content id=toc-content-auto></div></div><article class="page single"><h1 class="single-title animate__animated animate__flipInX">Arduino 101 GPIO 实现详解</h1><div class=post-meta><div class=post-meta-line><span class=post-author><a href=/ title=Author rel=author class=author><i class="fas fa-user-circle fa-fw" aria-hidden=true></i>Wishlily</a></span>&nbsp;<span class=post-category>收录于 <a href=/categories/embedded/><i class="far fa-folder fa-fw" aria-hidden=true></i>嵌入式</a></span></div><div class=post-meta-line><i class="far fa-calendar-alt fa-fw" aria-hidden=true></i>&nbsp;<time datetime=2017-04-20>2017-04-20</time>&nbsp;<i class="fas fa-pencil-alt fa-fw" aria-hidden=true></i>&nbsp;约 1550 字&nbsp;
<i class="far fa-clock fa-fw" aria-hidden=true></i>&nbsp;预计阅读 4 分钟&nbsp;</div></div><div class=featured-image><img class=lazyload src=/svg/loading.min.svg data-src=/images/banner/arduino.png data-srcset="/images/banner/arduino.png, /images/banner/arduino.png 1.5x, /images/banner/arduino.png 2x" data-sizes=auto alt=/images/banner/arduino.png title="Arduino 101 GPIO 实现详解" width=1200 height=630></div><div class="details toc" id=toc-static data-kept><div class="details-summary toc-title"><span>目录</span>
<span><i class="details-icon fas fa-angle-right" aria-hidden=true></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ul><li><a href=#概述>概述</a><ul><li><a href=#cpu>CPU</a></li><li><a href=#gpio>GPIO</a></li></ul></li><li><a href=#分析>分析</a><ul><li><a href=#初始化>初始化</a></li><li><a href=#输出>输出</a></li><li><a href=#输入>输入</a></li></ul></li><li><a href=#总结>总结</a><ul><li><a href=#配置>配置</a></li><li><a href=#读>读</a></li><li><a href=#写>写</a></li></ul></li></ul></nav></div></div><div class=content id=content><p>最近买了一块 Arduino 101 开发版，准备学习研究一下。<br>首先从最简单的 GPIO 开始。</p><h2 id=概述>概述</h2><p>要知道 GPIO 基本上都是 CPU 直接控制的，我们先查找一下 CPU 的资料。</p><h3 id=cpu>CPU</h3><p>主控制器是 Intel® Curie™ Module <sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup>，其整体结构图如下：</p><p><img class=lazyload src=/svg/loading.min.svg data-src=/article/2017/04/20/arduino-101-gpio-implementation-details/Intel_Curie_Module.png data-srcset="/article/2017/04/20/arduino-101-gpio-implementation-details/Intel_Curie_Module.png, /article/2017/04/20/arduino-101-gpio-implementation-details/Intel_Curie_Module.png 1.5x, /article/2017/04/20/arduino-101-gpio-implementation-details/Intel_Curie_Module.png 2x" data-sizes=auto alt=/article/2017/04/20/arduino-101-gpio-implementation-details/Intel_Curie_Module.png title="Intel® Curie™ Module" width=515 height=352></p><p>这是一个集成的控制芯片，我们发现其中的真正微控制器其实是 Intel® Quark™ SE Microcontroller C1000 <sup id=fnref:2><a href=#fn:2 class=footnote-ref role=doc-noteref>2</a></sup>，其结构框图如下：</p><p><img class=lazyload src=/svg/loading.min.svg data-src=/article/2017/04/20/arduino-101-gpio-implementation-details/Intel_Quark_C1000.png data-srcset="/article/2017/04/20/arduino-101-gpio-implementation-details/Intel_Quark_C1000.png, /article/2017/04/20/arduino-101-gpio-implementation-details/Intel_Quark_C1000.png 1.5x, /article/2017/04/20/arduino-101-gpio-implementation-details/Intel_Quark_C1000.png 2x" data-sizes=auto alt=/article/2017/04/20/arduino-101-gpio-implementation-details/Intel_Quark_C1000.png title="Intel® Quark™ SE Microcontroller C1000 Block Diagram" width=914 height=557></p><h3 id=gpio>GPIO</h3><p>手册中 1.10 节概述了 GPIO 控制器如下：</p><blockquote><p>GPIO Controller</p></blockquote><ul><li>Provides 32 independently configurable GPIOs</li><li>All GPIOs are interrupt capable, supporting level sensitive and edge triggered modes</li><li>Debounce logic for interrupt source</li><li>16 additional GPIOs available via Sensor Subsystem</li><li>6 additional Always-on interrupt and wake capable GPIOs</li></ul><p>概括来说 GPIO 由三部分组成：</p><ul><li>32 个独立配置口（暂用 <code>SOC_GPIO_32</code> 代表）</li><li>16 个额外通过传感器子系统提供（暂用 <code>SS_GPIO_16</code> 代表）</li><li>6 个额外提供中断及唤醒口（暂用 <code>AON_GPIO_6</code> 代表）</li></ul><h2 id=分析>分析</h2><p>Arduino 自带的 Blink 程序就是控制 GPIO 高低，从而开关 LED 灯。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=c1>// the setup function runs once when you press reset or power the board
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kt>void</span> <span class=nf>setup</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// initialize digital pin LED_BUILTIN as an output.
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nf>pinMode</span><span class=p>(</span><span class=n>LED_BUILTIN</span><span class=p>,</span> <span class=n>OUTPUT</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// the loop function runs over and over again forever
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kt>void</span> <span class=nf>loop</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nf>digitalWrite</span><span class=p>(</span><span class=n>LED_BUILTIN</span><span class=p>,</span> <span class=n>HIGH</span><span class=p>);</span>   <span class=c1>// turn the LED on (HIGH is the voltage level)
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nf>delay</span><span class=p>(</span><span class=mi>1000</span><span class=p>);</span>                       <span class=c1>// wait for a second
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nf>digitalWrite</span><span class=p>(</span><span class=n>LED_BUILTIN</span><span class=p>,</span> <span class=n>LOW</span><span class=p>);</span>    <span class=c1>// turn the LED off by making the voltage LOW
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nf>delay</span><span class=p>(</span><span class=mi>1000</span><span class=p>);</span>                       <span class=c1>// wait for a second
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span></code></pre></div><h3 id=初始化>初始化</h3><pre><code>void pinMode( uint8_t pin, uint8_t mode )
</code></pre><ul><li>pin: Arduino 定义的 GPIO 编号</li><li>mode: INPUT，INPUT_PULLUP，OUTPUT</li></ul><p>那么这个函数是怎么一步步配置到寄存器的呢？<br>首先找到 <code>pinMode</code> 函数实现如下：</p><blockquote><p>C:\Users\XXX\AppData\Local\Arduino15\packages\Intel\hardware\arc32\2.0.2\cores\arduino\wiring_digital.c</p></blockquote><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=kt>void</span> <span class=nf>pinMode</span><span class=p>(</span> <span class=kt>uint8_t</span> <span class=n>pin</span><span class=p>,</span> <span class=kt>uint8_t</span> <span class=n>mode</span> <span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=cm>/* 101 NUM_DIGITAL_PINS=32 */</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=n>pin</span> <span class=o>&gt;=</span> <span class=n>NUM_DIGITAL_PINS</span><span class=p>)</span> <span class=k>return</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=cm>/* g_APinDescription 为映射结构体数组 */</span>
</span></span><span class=line><span class=cl>    <span class=n>PinDescription</span> <span class=o>*</span><span class=n>p</span> <span class=o>=</span> <span class=o>&amp;</span><span class=n>g_APinDescription</span><span class=p>[</span><span class=n>pin</span><span class=p>];</span>
</span></span><span class=line><span class=cl>    <span class=p>...</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p><code>PinDescription</code> 映射配置结构体包含如下：</p><blockquote><p>C:\Users\XXX\AppData\Local\Arduino15\packages\Intel\hardware\arc32\2.0.2\cores\arduino\Arduino.h</p></blockquote><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=k>typedef</span> <span class=k>const</span> <span class=k>struct</span> <span class=n>_PinDescription</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>uint32_t</span>                <span class=n>ulGPIOId</span><span class=p>;</span>               <span class=c1>// GPIO port pin
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kt>uint32_t</span>                <span class=n>ulGPIOPort</span><span class=p>;</span>             <span class=c1>// GPIO port ID
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kt>uint32_t</span>                <span class=n>ulGPIOType</span><span class=p>;</span>             <span class=c1>// LMT or SS
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kt>uint32_t</span>                <span class=n>ulGPIOBase</span><span class=p>;</span>             <span class=c1>// GPIO register base address
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kt>uint32_t</span>                <span class=n>ulSocPin</span><span class=p>;</span>               <span class=c1>// SoC pin number
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kt>uint32_t</span>                <span class=n>ulPinMode</span><span class=p>;</span>              <span class=c1>// Current SoC pin mux mode
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kt>uint32_t</span>                <span class=n>ulPwmChan</span><span class=p>;</span>              <span class=c1>// PWM channel
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kt>uint32_t</span>                <span class=n>ulPwmScale</span><span class=p>;</span>             <span class=c1>// PWM frequency scaler
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kt>uint32_t</span>                <span class=n>ulAdcChan</span><span class=p>;</span>              <span class=c1>// ADC channel
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kt>uint32_t</span>                <span class=n>ulInputMode</span><span class=p>;</span>            <span class=c1>// Pin mode
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span> <span class=n>PinDescription</span><span class=p>;</span>
</span></span></code></pre></div><p><code>g_APinDescription</code> 就是提前配置好的全局结构体数组，输入 <code>pin=LED_BUILTIN</code>，即编号十三引脚。</p><blockquote><p>C:\Users\XXX\AppData\Local\Arduino15\packages\Intel\hardware\arc32\2.0.2\variants\arduino_101\pins_arduino.h</p></blockquote><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=k>static</span> <span class=k>const</span> <span class=kt>uint8_t</span> <span class=n>LED_BUILTIN</span> <span class=o>=</span> <span class=mi>13</span><span class=p>;</span>
</span></span></code></pre></div><p>而十三引脚的映射如下：</p><blockquote><p>C:\Users\XXX\AppData\Local\Arduino15\packages\Intel\hardware\arc32\2.0.2\variants\arduino_101\variant.cpp</p></blockquote><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=n>PinDescription</span> <span class=n>g_APinDescription</span><span class=p>[]</span><span class=o>=</span><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=p>...</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span><span class=mi>8</span><span class=p>,</span> <span class=n>SOC_GPIO_32</span><span class=p>,</span> <span class=n>SOC_GPIO</span><span class=p>,</span> <span class=n>SOC_GPIO_BASE_ADDR</span><span class=p>,</span> <span class=mi>42</span><span class=p>,</span> <span class=n>GPIO_MUX_MODE</span><span class=p>,</span> <span class=n>INVALID</span><span class=p>,</span> <span class=n>INVALID</span><span class=p>,</span> <span class=n>INVALID</span><span class=p>,</span> <span class=n>INPUT_MODE</span><span class=p>},</span> <span class=c1>// Arduino IO13
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=p>...</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span></code></pre></div><p><code>mode=OUTPUT</code> 把编号十三引脚设置为输出模式，进入如下分支（<code>ulGPIOType=SOC_GPIO</code>）：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=kt>void</span> <span class=nf>pinMode</span><span class=p>(</span> <span class=kt>uint8_t</span> <span class=n>pin</span><span class=p>,</span> <span class=kt>uint8_t</span> <span class=n>mode</span> <span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=p>...</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=n>mode</span> <span class=o>==</span> <span class=n>OUTPUT</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=p>...</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span> <span class=k>if</span> <span class=p>(</span><span class=n>p</span><span class=o>-&gt;</span><span class=n>ulGPIOType</span> <span class=o>==</span> <span class=n>SOC_GPIO</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=kt>uint32_t</span> <span class=n>reg</span> <span class=o>=</span> <span class=n>p</span><span class=o>-&gt;</span><span class=n>ulGPIOBase</span> <span class=o>+</span> <span class=n>SOC_GPIO_SWPORTA_DDR</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=nf>SET_MMIO_BIT</span><span class=p>(</span><span class=n>reg</span><span class=p>,</span> <span class=n>p</span><span class=o>-&gt;</span><span class=n>ulGPIOId</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>...</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>可以看出映射到的寄存器地址是 0xB0000C04，<br><em>（reg = SOC_GPIO_BASE_ADDR + SOC_GPIO_SWPORTA_DDR）</em></p><blockquote><p>C:\Users\XXX\AppData\Local\Arduino15\packages\Intel\hardware\arc32\2.0.2\system\libarc32_arduino101\common\scss_registers.h</p></blockquote><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=cp>#define SOC_GPIO_BASE_ADDR              0xB0000C00
</span></span></span><span class=line><span class=cl><span class=cp>#define SOC_GPIO_SWPORTA_DDR            0x04
</span></span></span></code></pre></div><p><code>SET_MMIO_BIT</code> 是在 0xB0000C04 地址 bit 8 位设置为 1。</p><p>查找手册相应说明如下：</p><p><img class=lazyload src=/svg/loading.min.svg data-src=/article/2017/04/20/arduino-101-gpio-implementation-details/PortA_DDR.png data-srcset="/article/2017/04/20/arduino-101-gpio-implementation-details/PortA_DDR.png, /article/2017/04/20/arduino-101-gpio-implementation-details/PortA_DDR.png 1.5x, /article/2017/04/20/arduino-101-gpio-implementation-details/PortA_DDR.png 2x" data-sizes=auto alt=/article/2017/04/20/arduino-101-gpio-implementation-details/PortA_DDR.png title=GPIO_SWPORTA_DDR width=824 height=233></p><p>即把 <code>SOC_GPIO_32[8]</code> 设置为输出，那么 LED 实际上到底是不是 <code>GPIO[8]</code> 呢？<br>原理图 LED 部分如下：</p><p><img class=lazyload src=/svg/loading.min.svg data-src=/article/2017/04/20/arduino-101-gpio-implementation-details/LED_sch.png data-srcset="/article/2017/04/20/arduino-101-gpio-implementation-details/LED_sch.png, /article/2017/04/20/arduino-101-gpio-implementation-details/LED_sch.png 1.5x, /article/2017/04/20/arduino-101-gpio-implementation-details/LED_sch.png 2x" data-sizes=auto alt=/article/2017/04/20/arduino-101-gpio-implementation-details/LED_sch.png title=LED_sch width=647 height=225></p><p>而 <code>ATPSCK/IO2_3V_IO13</code> 和 Curie 芯片有两处相连接，分别是 <code>SPI1_M_SCK</code> 和 <code>ATP_SPI_S_SCK</code>，<br>在 Curie 中找到相应引脚信息如下：</p><p><img class=lazyload src=/svg/loading.min.svg data-src=/article/2017/04/20/arduino-101-gpio-implementation-details/LED_pin_map.png data-srcset="/article/2017/04/20/arduino-101-gpio-implementation-details/LED_pin_map.png, /article/2017/04/20/arduino-101-gpio-implementation-details/LED_pin_map.png 1.5x, /article/2017/04/20/arduino-101-gpio-implementation-details/LED_pin_map.png 2x" data-sizes=auto alt=/article/2017/04/20/arduino-101-gpio-implementation-details/LED_pin_map.png title=SPI1_M_SCK width=975 height=128></p><p>如此证明之前的推测是正确的，<code>SOC_GPIO_32[8]</code> 控制着 LED 开关，GPIO 为高时，LED 亮，反之，LED 灭。</p><h3 id=输出>输出</h3><pre><code>void digitalWrite( uint8_t pin, uint8_t val )
</code></pre><ul><li>pin: 0~31</li><li>val: HIGH，LOW</li></ul><h3 id=输入>输入</h3><pre><code>int digitalRead( uint8_t pin )
</code></pre><ul><li>pin: 0~31</li></ul><h2 id=总结>总结</h2><p>由上面分析可知，程序是通过一个事先定义好的映射表来查找对应的寄存器地址，再来设置相应的数据。<br>较重要的几个文件是：</p><ul><li>wiring_digital.c：设置 GPIO 寄存器，包括初始化，读和写</li><li>variant.cpp：配置映射表</li><li>scss_registers.h：寄存器地址</li></ul><h3 id=配置>配置</h3><h4 id=soc_gpio_32>SOC_GPIO_32</h4><ol><li><code>GPIO_SWPORTA_DDR</code> 设置输入/输出口</li><li><code>PMUX_PULLUP [0..3]</code> 设置是否使能上拉</li></ol><blockquote><p>这是一个多路复用寄存器可以设置外部引脚是否为上拉输入，<br>寄存器和引脚的映射，我没有找到明确的解释，但是查看官方的软件说明<sup id=fnref:3><a href=#fn:3 class=footnote-ref role=doc-noteref>3</a></sup>后，<br>我基本确定 4 × 32 的寄存器标号即 <code>EXTERNAL_PAD_XX</code> 中 <code>XX</code> 标号<sup id=fnref:4><a href=#fn:4 class=footnote-ref role=doc-noteref>4</a></sup>。<br>如：GPIO[8] 为 <code>EXTERNAL_PAD_42</code> 那么如果设置其为上拉，<br>则，<code>PMUX_PULLUP[1] bit 10 = 1</code>。<br>ps，手册中有两种封装，因为我们用的是 Curie 芯片，该芯片使用的是 WLCSP 封装，所以查看引脚表格也是看该封装的。</p></blockquote><ol start=3><li><code>PMUX_SEL [0..5]</code> 设置引脚复用</li></ol><h4 id=ss_gpio_16>SS_GPIO_16</h4><blockquote><p>在手册中我没有找到该部分寄存器定义，以下根据程序得出</p></blockquote><ol><li><code>SS_GPIO0_SWPORTA_DDR</code> or <code>SS_GPIO1_SWPORTA_DDR</code> 设置输入/输出</li><li><code>PMUX_PULLUP [0..3]</code> 设置是否使能上拉</li><li><code>PMUX_SEL [0..5]</code> 设置引脚复用</li></ol><h4 id=aon_gpio_6>AON_GPIO_6</h4><ol><li><code>GPIO_AON_SWPORTA_DDR</code> 设置是输入/输出</li><li><code>PMUX_PULLUP [0..3]</code> 设置是否使能上拉</li><li><code>PMUX_SEL [0..5]</code> 设置引脚复用</li></ol><h3 id=读>读</h3><h4 id=soc_gpio_32-1>SOC_GPIO_32</h4><p>读取 <code>GPIO_EXT_PORTA</code> 寄存器状态</p><h4 id=ss_gpio_16-1>SS_GPIO_16</h4><p>读取 <code>SS_GPIO_EXT_PORTA</code> 寄存器状态</p><h4 id=aon_gpio_6-1>AON_GPIO_6</h4><p>读取 <code>GPIO_AON_EXT_PORTA</code> 寄存器状态</p><h3 id=写>写</h3><h4 id=soc_gpio_32-2>SOC_GPIO_32</h4><ol><li>写入 <code>GPIO_SWPORTA_DR</code> 寄存器</li><li>设置 <code>PMUX_PULLUP [0..3]</code> 是否使能上拉</li></ol><h4 id=ss_gpio_16-2>SS_GPIO_16</h4><ol><li>写入 <code>SS_GPIO_SWPORTA_DR</code> 寄存器</li><li>设置 <code>PMUX_PULLUP [0..3]</code> 是否使能上拉</li></ol><h4 id=aon_gpio_6-2>AON_GPIO_6</h4><ol><li>写入 <code>GPIO_AON_SWPORTA_DR</code> 寄存器</li><li>设置 <code>PMUX_PULLUP [0..3]</code> 是否使能上拉</li></ol><div class=footnotes role=doc-endnotes><hr><ol><li id=fn:1><p><a href=http://www.intel.com/content/www/us/en/support/boards-and-kits/intel-curie-modules/000022330.html target=_blank rel="noopener noreffer">Datasheet for the Intel® Curie™ Module</a>&#160;<a href=#fnref:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:2><p><a href="chrome-extension://ikhdkkncnoglghljlkmcimlnlhkeamad/pdf-viewer/web/viewer.html?file=http%3A%2F%2Fwww.intel.com%2Fcontent%2Fdam%2Fwww%2Fpublic%2Fus%2Fen%2Fdocuments%2Fdatasheets%2Fquark-c1000-datasheet.pdf" target=_blank rel="noopener noreffer">Intel® Quark™ SE Microcontroller C1000 Datasheet</a>&#160;<a href=#fnref:2 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:3><p><a href="chrome-extension://ikhdkkncnoglghljlkmcimlnlhkeamad/pdf-viewer/web/viewer.html?file=http%3A%2F%2Fwww.intel.com%2Fcontent%2Fdam%2Fwww%2Fpublic%2Fus%2Fen%2Fdocuments%2Freference-guides%2Fquark-software-interface-pin-multiplexing-reference-guide.pdf" target=_blank rel="noopener noreffer">Intel®Quark™Microcontroller Software Interface Pin Multiplexing Reference Guide</a>&#160;<a href=#fnref:3 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:4><p>Intel® Quark™ SE Microcontroller C1000 Datasheet, 3.5, Ballmap Name&#160;<a href=#fnref:4 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li></ol></div></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span>更新于 2017-04-20</span></div></div><div class=post-info-line><div class=post-info-md></div><div class=post-info-share><span><a href=javascript:void(0); title="分享到 Facebook" data-sharer=facebook data-url=https://wishlily.github.io/article/2017/04/20/arduino-101-gpio-implementation-details/ data-hashtag=arduino><i class="fab fa-facebook-square fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="分享到 Hacker News" data-sharer=hackernews data-url=https://wishlily.github.io/article/2017/04/20/arduino-101-gpio-implementation-details/ data-title="Arduino 101 GPIO 实现详解"><i class="fab fa-hacker-news fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="分享到 Reddit" data-sharer=reddit data-url=https://wishlily.github.io/article/2017/04/20/arduino-101-gpio-implementation-details/><i class="fab fa-reddit fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="分享到 Line" data-sharer=line data-url=https://wishlily.github.io/article/2017/04/20/arduino-101-gpio-implementation-details/ data-title="Arduino 101 GPIO 实现详解"><i data-svg-src=https://cdn.jsdelivr.net/npm/simple-icons@7.3.0/icons/line.svg aria-hidden=true></i></a><a href=javascript:void(0); title="分享到 微博" data-sharer=weibo data-url=https://wishlily.github.io/article/2017/04/20/arduino-101-gpio-implementation-details/ data-title="Arduino 101 GPIO 实现详解" data-image=/images/banner/arduino.png><i class="fab fa-weibo fa-fw" aria-hidden=true></i></a></span></div></div></div><div class=post-info-more><section class=post-tags><i class="fas fa-tags fa-fw" aria-hidden=true></i>&nbsp;<a href=/tags/arduino/>Arduino</a>,&nbsp;<a href=/tags/quark/>Quark</a>,&nbsp;<a href=/tags/gpio/>Gpio</a></section><section><span><a href=javascript:void(0); onclick=window.history.back()>返回</a></span>&nbsp;|&nbsp;<span><a href=/>主页</a></span></section></div><div class=post-nav><a href=/article/2017/04/07/sierpinski-triangle/ class=prev rel=prev title=谢尔宾斯基三角形><i class="fas fa-angle-left fa-fw" aria-hidden=true></i>谢尔宾斯基三角形</a>
<a href=/article/2017/06/15/gcc/ class=next rel=next title="GCC 常用">GCC 常用<i class="fas fa-angle-right fa-fw" aria-hidden=true></i></a></div></div><div id=comments><div id=giscus class=comment></div><noscript>Please enable JavaScript to view the comments powered by <a href=https://giscus.app>Giscus</a>.</noscript></div></article></div></main><footer class=footer><div class=footer-container><div class=footer-line>由 <a href=https://gohugo.io/ target=_blank rel="noopener noreffer" title="Hugo 0.145.0">Hugo</a> 强力驱动 | 主题 - <a href=https://github.com/dillonzq/LoveIt target=_blank rel="noopener noreffer" title="LoveIt 0.3.0"><i class="far fa-kiss-wink-heart fa-fw" aria-hidden=true></i> LoveIt</a></div><div class=footer-line itemscope itemtype=http://schema.org/CreativeWork><i class="far fa-copyright fa-fw" aria-hidden=true></i><span itemprop=copyrightYear>2015 - 2025</span><span class=author itemprop=copyrightHolder>&nbsp;<a href=/ target=_blank>Wishlily</a></span>&nbsp;|&nbsp;<span class=license><a rel="license external nofollow noopener noreffer" href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank>CC BY-NC 4.0</a></span></div></div></footer></div><div id=fixed-buttons><a href=# id=back-to-top class=fixed-button title=回到顶部><i class="fas fa-arrow-up fa-fw" aria-hidden=true></i>
</a><a href=# id=view-comments class=fixed-button title=查看评论><i class="fas fa-comment fa-fw" aria-hidden=true></i></a></div><script type=text/javascript src=https://cdn.jsdelivr.net/npm/autocomplete.js@0.38.1/dist/autocomplete.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/lunr@2.3.9/lunr.min.js></script><script type=text/javascript src=/lib/lunr/lunr.stemmer.support.min.js></script><script type=text/javascript src=/lib/lunr/lunr.zh.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/lazysizes@5.3.2/lazysizes.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/clipboard@2.0.11/dist/clipboard.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/sharer.js@0.5.1/sharer.min.js></script><script type=text/javascript>window.config={code:{copyTitle:"复制到剪贴板",maxShownLines:50},comment:{giscus:{category:"Q&A",categoryId:"DIC_kwDODuSf184Ct4tE",darkTheme:"dark",emitMetadata:"0",inputPosition:"top",lang:"zh-CN",lazyLoading:!0,lightTheme:"light",mapping:"pathname",reactionsEnabled:"1",repo:"wishlily/wishlily.github.io",repoId:"MDEwOlJlcG9zaXRvcnkyNDk4NjQxNTE="}},search:{highlightTag:"em",lunrIndexURL:"/index.json",lunrLanguageCode:"zh",lunrSegmentitURL:"/lib/lunr/lunr.segmentit.js",maxResultLength:10,noResultsFound:"没有找到结果",snippetLength:50,type:"lunr"}}</script><script type=text/javascript src=/js/theme.min.js></script><script type=text/javascript>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-R4ZHVCJLGY",{anonymize_ip:!0})</script><script type=text/javascript src="https://www.googletagmanager.com/gtag/js?id=G-R4ZHVCJLGY" async></script></body></html>