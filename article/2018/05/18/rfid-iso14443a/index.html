<!doctype html><html lang=zh-CN><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><title>RFID：ISO14443A - Wishlily's blog</title><meta name=Description content="RFID：ISO14443A"><meta property="og:url" content="https://wishlily.github.io/article/2018/05/18/rfid-iso14443a/">
<meta property="og:site_name" content="Wishlily's blog"><meta property="og:title" content="RFID：ISO14443A"><meta property="og:description" content="RFID：ISO14443A"><meta property="og:locale" content="zh_CN"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2018-05-18T14:43:30+00:00"><meta property="article:modified_time" content="2018-05-18T14:43:30+00:00"><meta property="article:tag" content="Rfid"><meta property="article:tag" content="Pn512"><meta property="article:tag" content="M1"><meta property="og:image" content="https://wishlily.github.io/article/2018/05/18/rfid-iso14443a/banner.png"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://wishlily.github.io/article/2018/05/18/rfid-iso14443a/banner.png"><meta name=twitter:title content="RFID：ISO14443A"><meta name=twitter:description content="RFID：ISO14443A"><meta name=application-name content="Wishlily's blog"><meta name=apple-mobile-web-app-title content="Wishlily's blog"><meta name=theme-color content="#ffffff"><meta name=msapplication-TileColor content="#da532c"><link rel=icon href=/favicon.svg><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=manifest href=/site.webmanifest><link rel=canonical href=https://wishlily.github.io/article/2018/05/18/rfid-iso14443a/><link rel=prev href=https://wishlily.github.io/article/2018/05/15/figure-bed/><link rel=next href=https://wishlily.github.io/article/2018/09/29/react-component-communication/><link rel=stylesheet href=/css/style.min.css><link rel=preload href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css as=style onload='this.onload=null,this.rel="stylesheet"'><noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css></noscript><link rel=preload href=https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css as=style onload='this.onload=null,this.rel="stylesheet"'><noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css></noscript><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"RFID：ISO14443A","inLanguage":"zh-CN","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/wishlily.github.io\/article\/2018\/05\/18\/rfid-iso14443a\/"},"image":[{"@type":"ImageObject","url":"https:\/\/wishlily.github.io\/article\/2018\/05\/18\/rfid-iso14443a\/banner.png","width":1536,"height":594}],"genre":"posts","keywords":"rfid, pn512, m1","wordcount":2103,"url":"https:\/\/wishlily.github.io\/article\/2018\/05\/18\/rfid-iso14443a\/","datePublished":"2018-05-18T14:43:30+00:00","dateModified":"2018-05-18T14:43:30+00:00","publisher":{"@type":"Organization","name":""},"author":{"@type":"Person","name":"Wishlily"},"description":"RFID：ISO14443A"}</script></head><body data-header-desktop=fixed data-header-mobile=auto><script type=text/javascript>(window.localStorage&&localStorage.getItem("theme")?localStorage.getItem("theme")==="dark":"auto"==="auto"?window.matchMedia("(prefers-color-scheme: dark)").matches:"auto"==="dark")&&document.body.setAttribute("theme","dark")</script><div id=mask></div><div class=wrapper><header class=desktop id=header-desktop><div class=header-wrapper><div class=header-title><a href=/ title="Wishlily's blog"><img class="lazyload logo" src=/svg/loading.min.svg data-src=/favicon.ico data-srcset="/favicon.ico, /favicon.ico 1.5x, /favicon.ico 2x" data-sizes=auto alt=/favicon.ico title=/favicon.ico>Wishlily's blog</a></div><div class=menu><div class=menu-inner><a class=menu-item href=/posts/>文章 </a><a class=menu-item href=/tags/>标签 </a><a class=menu-item href=/categories/>分类 </a><a class=menu-item href=/series/>系列 </a><span class="menu-item delimiter"></span><span class="menu-item search" id=search-desktop>
<input type=text placeholder=搜索文章标题或内容... id=search-input-desktop>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-desktop title=搜索><i class="fas fa-search fa-fw" aria-hidden=true></i>
</a><a href=javascript:void(0); class="search-button search-clear" id=search-clear-desktop title=清空><i class="fas fa-times-circle fa-fw" aria-hidden=true></i>
</a><span class="search-button search-loading" id=search-loading-desktop><i class="fas fa-spinner fa-fw fa-spin" aria-hidden=true></i>
</span></span><a href=javascript:void(0); class="menu-item theme-switch" title=切换主题><i class="fas fa-adjust fa-fw" aria-hidden=true></i></a></div></div></div></header><header class=mobile id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title="Wishlily's blog"><img class="lazyload logo" src=/svg/loading.min.svg data-src=/favicon.ico data-srcset="/favicon.ico, /favicon.ico 1.5x, /favicon.ico 2x" data-sizes=auto alt=/favicon.ico title=/favicon.ico>Wishlily's blog</a></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><div class=menu id=menu-mobile><div class=search-wrapper><div class="search mobile" id=search-mobile><input type=text placeholder=搜索文章标题或内容... id=search-input-mobile>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-mobile title=搜索><i class="fas fa-search fa-fw" aria-hidden=true></i>
</a><a href=javascript:void(0); class="search-button search-clear" id=search-clear-mobile title=清空><i class="fas fa-times-circle fa-fw" aria-hidden=true></i>
</a><span class="search-button search-loading" id=search-loading-mobile><i class="fas fa-spinner fa-fw fa-spin" aria-hidden=true></i></span></div><a href=javascript:void(0); class=search-cancel id=search-cancel-mobile>取消</a></div><a class=menu-item href=/posts/ title>文章</a><a class=menu-item href=/tags/ title>标签</a><a class=menu-item href=/categories/ title>分类</a><a class=menu-item href=/series/ title>系列</a><a href=javascript:void(0); class="menu-item theme-switch" title=切换主题>
<i class="fas fa-adjust fa-fw" aria-hidden=true></i></a></div></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><main class=main><div class=container><div class=toc id=toc-auto><h2 class=toc-title>目录</h2><div class=toc-content id=toc-content-auto></div></div><article class="page single"><h1 class="single-title animate__animated animate__flipInX">RFID：ISO14443A</h1><div class=post-meta><div class=post-meta-line><span class=post-author><a href=/ title=Author rel=author class=author><i class="fas fa-user-circle fa-fw" aria-hidden=true></i>Wishlily</a></span>&nbsp;<span class=post-category>收录于 <a href=/categories/wireless/><i class="far fa-folder fa-fw" aria-hidden=true></i>无线</a></span></div><div class=post-meta-line><i class="far fa-calendar-alt fa-fw" aria-hidden=true></i>&nbsp;<time datetime=2018-05-18>2018-05-18</time>&nbsp;<i class="fas fa-pencil-alt fa-fw" aria-hidden=true></i>&nbsp;约 2103 字&nbsp;
<i class="far fa-clock fa-fw" aria-hidden=true></i>&nbsp;预计阅读 5 分钟&nbsp;</div></div><div class=featured-image><img class=lazyload src=/svg/loading.min.svg data-src=/article/2018/05/18/rfid-iso14443a/banner.png data-srcset="/article/2018/05/18/rfid-iso14443a/banner.png, /article/2018/05/18/rfid-iso14443a/banner.png 1.5x, /article/2018/05/18/rfid-iso14443a/banner.png 2x" data-sizes=auto alt=/article/2018/05/18/rfid-iso14443a/banner.png title=RFID：ISO14443A></div><div class="details toc" id=toc-static data-kept><div class="details-summary toc-title"><span>目录</span>
<span><i class="details-icon fas fa-angle-right" aria-hidden=true></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ul><li><a href=#选卡>选卡</a><ul><li><a href=#picc---power-off>PICC -> Power Off</a></li><li><a href=#picc---idle>PICC -> Idle</a></li><li><a href=#reqa---pcd>REQA &lt;- PCD</a></li><li><a href=#picc---atqa>PICC -> ATQA</a></li><li><a href=#anticollision---pcd>Anticollision &lt;- PCD</a></li><li><a href=#picc---uid>PICC -> UID</a></li><li><a href=#sel---pcd>SEL &lt;- PCD</a></li><li><a href=#picc---sak>PICC -> SAK</a></li></ul></li><li><a href=#读写-eeprom>读写 EEPROM</a><ul><li><a href=#mifare1-card>Mifare1 Card</a></li><li><a href=#authentication>Authentication</a></li><li><a href=#read>Read</a></li><li><a href=#write>Write</a></li><li><a href=#other>Other</a></li></ul></li><li><a href=#总结>总结</a></li></ul></nav></div></div><div class=content id=content><p>这是篇几年前总结的文档，现在重新整理一下。<br>首先建议看下《<a href=http://bbs.21ic.com/blog-15467-89510.html target=_blank rel="noopener noreffer">看得懂的 RFID 原理</a>》这篇文章，当初找了不少资料就这篇让我明白了些 RFID 是怎么通信的。</p><p>ISO14443A 是常见的协议标准，大致如下：</p><p>载波频率 f：13.56MHz<br>数据传输率：13.56MHz/128 = 106Kbit/s<br>普通卡 PICC UID：</p><ul><li>4 个字节 32 位数据</li><li>7 个字节</li><li>10 个字节</li></ul><p>各部分协议内容：</p><ol><li>ISO/IEC 14443-1 制定了 PICC 的物理特性</li><li>ISO/IEC 14443-2 制定了射频功率及信号界面特性</li><li>ISO/IEC 14443-3 PICC 初始化和防冲突机制</li><li>ISO/IEC 14443-4 有关交易的协定</li></ol><p>以下通过读卡器读卡来理解该协议，其中缩写表示如下：<br>PICC：普通卡（M1 卡）<br>PCD：读卡器（PN512）</p><h2 id=选卡>选卡</h2><h3 id=picc---power-off>PICC -> Power Off</h3><p>PICC 静止状态周围没有可激活的 PCD 有效场</p><h3 id=picc---idle>PICC -> Idle</h3><p>PICC 进入 PCD 有效场，进入 Idle 状态（t&lt;=5ms），Idle 态可接受命令</p><h3 id=reqa---pcd>REQA &lt;- PCD</h3><p>PCD 发送 REQA，检测是否有 PICC，0x26 7-bit 数据<br><img class=lazyload src=/svg/loading.min.svg data-src=/article/2018/05/18/rfid-iso14443a/20180517-reqa.png data-srcset="/article/2018/05/18/rfid-iso14443a/20180517-reqa.png, /article/2018/05/18/rfid-iso14443a/20180517-reqa.png 1.5x, /article/2018/05/18/rfid-iso14443a/20180517-reqa.png 2x" data-sizes=auto alt=/article/2018/05/18/rfid-iso14443a/20180517-reqa.png title=REQA width=273 height=75></p><blockquote><p>Ps：两个连续 REQA 间隔 7000 / f （> 0.516ms）</p></blockquote><pre tabindex=0><code>//&gt; Mifare Request:
SR 0A 80    // flush FIFO
SR 09 26    // FIFO - Request code
SR 0D 87    // BitframingReg - StartSend, TxLastBits
</code></pre><blockquote><p>PN512 简单测试用例脚本</p></blockquote><h3 id=picc---atqa>PICC -> ATQA</h3><p>PICC 向 PCD 发送自身信息<br><img class=lazyload src=/svg/loading.min.svg data-src=/article/2018/05/18/rfid-iso14443a/20180517-atqa.png data-srcset="/article/2018/05/18/rfid-iso14443a/20180517-atqa.png, /article/2018/05/18/rfid-iso14443a/20180517-atqa.png 1.5x, /article/2018/05/18/rfid-iso14443a/20180517-atqa.png 2x" data-sizes=auto alt=/article/2018/05/18/rfid-iso14443a/20180517-atqa.png title=ATQA width=553 height=92><br>其中 b7b8 可以知道该卡 UID 字节数，一般定义如下：<br><img class=lazyload src=/svg/loading.min.svg data-src=/article/2018/05/18/rfid-iso14443a/20180517-uid.png data-srcset="/article/2018/05/18/rfid-iso14443a/20180517-uid.png, /article/2018/05/18/rfid-iso14443a/20180517-uid.png 1.5x, /article/2018/05/18/rfid-iso14443a/20180517-uid.png 2x" data-sizes=auto alt=/article/2018/05/18/rfid-iso14443a/20180517-uid.png title=UID width=318 height=103><br>b5-b1 一般只有 1bit 为 1，如果有 2bit 为 1 则冲突了</p><pre tabindex=0><code>//&gt; Response ATQ:
GR 06       // Read ErrReg
RE 0A 02    // Read FIFOLevel
GR 09       // ATQ LSB    // data=04
GR 09       // ATQ MSB    // data=00 -&gt; Mifare Plus
</code></pre><blockquote><p>PCD 读到的数据是 0x0004，通过芯片官方文档（见下）可知该卡是 Mifare Plus 4 Byte UID 型号<br><img class=lazyload src=/svg/loading.min.svg data-src=/article/2018/05/18/rfid-iso14443a/20180517-uid-nxp.png data-srcset="/article/2018/05/18/rfid-iso14443a/20180517-uid-nxp.png, /article/2018/05/18/rfid-iso14443a/20180517-uid-nxp.png 1.5x, /article/2018/05/18/rfid-iso14443a/20180517-uid-nxp.png 2x" data-sizes=auto alt=/article/2018/05/18/rfid-iso14443a/20180517-uid-nxp.png title=NXP width=554 height=379></p></blockquote><h3 id=anticollision---pcd>Anticollision &lt;- PCD</h3><p>防冲突没有实践过，所以可能理解有误。<br>下图是防冲突流程图：<br><img class=lazyload src=/svg/loading.min.svg data-src=/article/2018/05/18/rfid-iso14443a/20180517-anticollision.png data-srcset="/article/2018/05/18/rfid-iso14443a/20180517-anticollision.png, /article/2018/05/18/rfid-iso14443a/20180517-anticollision.png 1.5x, /article/2018/05/18/rfid-iso14443a/20180517-anticollision.png 2x" data-sizes=auto alt=/article/2018/05/18/rfid-iso14443a/20180517-anticollision.png title=anticollision width=617 height=754><br>由上图可以看出 PCD 发送的命令有 <code>SEL</code> <code>NVB</code> <code>UID CLn</code> 等部分组成：</p><ul><li><code>SEL</code>：Select code 值可能是 0x93 0x95 0x97，表示不同的冲突阶段<br><img class=lazyload src=/svg/loading.min.svg data-src=/article/2018/05/18/rfid-iso14443a/20180517-sel.png data-srcset="/article/2018/05/18/rfid-iso14443a/20180517-sel.png, /article/2018/05/18/rfid-iso14443a/20180517-sel.png 1.5x, /article/2018/05/18/rfid-iso14443a/20180517-sel.png 2x" data-sizes=auto alt=/article/2018/05/18/rfid-iso14443a/20180517-sel.png title=sel width=1084 height=377><br>防冲突等级区分如下（感觉和 UID 大小有关）：<br><img class=lazyload src=/svg/loading.min.svg data-src=/article/2018/05/18/rfid-iso14443a/20180517-sel-level.png data-srcset="/article/2018/05/18/rfid-iso14443a/20180517-sel-level.png, /article/2018/05/18/rfid-iso14443a/20180517-sel-level.png 1.5x, /article/2018/05/18/rfid-iso14443a/20180517-sel-level.png 2x" data-sizes=auto alt=/article/2018/05/18/rfid-iso14443a/20180517-sel-level.png title=sel-level width=1067 height=517></li><li><code>NVB</code>：Number of Valid Bits 冲突发生的位置（第几个字节第几个位置）<br><img class=lazyload src=/svg/loading.min.svg data-src=/article/2018/05/18/rfid-iso14443a/20180517-nvb.png data-srcset="/article/2018/05/18/rfid-iso14443a/20180517-nvb.png, /article/2018/05/18/rfid-iso14443a/20180517-nvb.png 1.5x, /article/2018/05/18/rfid-iso14443a/20180517-nvb.png 2x" data-sizes=auto alt=/article/2018/05/18/rfid-iso14443a/20180517-nvb.png title=nvb width=1024 height=454></li></ul><p>官方文档有个防冲突例子，感觉还挺清楚的：<br><img class=lazyload src=/svg/loading.min.svg data-src=/article/2018/05/18/rfid-iso14443a/20180517-anticollision-eg.png data-srcset="/article/2018/05/18/rfid-iso14443a/20180517-anticollision-eg.png, /article/2018/05/18/rfid-iso14443a/20180517-anticollision-eg.png 1.5x, /article/2018/05/18/rfid-iso14443a/20180517-anticollision-eg.png 2x" data-sizes=auto alt=/article/2018/05/18/rfid-iso14443a/20180517-anticollision-eg.png title=eg width=647 height=769></p><blockquote><p>我的理解 PCD 防冲突检测第一阶段,要求所有 PICC 返回自己的 UID，<br>读卡器发送：<code>0x93 0x20</code>，<br>当冲突发生时，PCD 接收不完整的 UID，截止在冲突处（不是很明白 PCD 怎么知道冲突了？），<br>下次 PCD 发送收到不完整 UID，PICC 接着响应直到没有冲突。</p></blockquote><h3 id=picc---uid>PICC -> UID</h3><p>PICC 返回自己的 UID（记不清 PCD 是不是要先发送 <code>0x93 0x20</code> 了）<br>UID 格式如下：<br><img class=lazyload src=/svg/loading.min.svg data-src=/article/2018/05/18/rfid-iso14443a/20180517-uid-bcc.png data-srcset="/article/2018/05/18/rfid-iso14443a/20180517-uid-bcc.png, /article/2018/05/18/rfid-iso14443a/20180517-uid-bcc.png 1.5x, /article/2018/05/18/rfid-iso14443a/20180517-uid-bcc.png 2x" data-sizes=auto alt=/article/2018/05/18/rfid-iso14443a/20180517-uid-bcc.png title=uid-bcc width=286 height=64></p><pre tabindex=0><code>//&gt;         Response SNR:
GR 06       // Read ErrReg
RE 0A 05    // Read FIFOLevel
GR 09       // Read SNR 0   // data=7A
GR 09       // Read SNR 1   // data=4E
GR 09       // Read SNR 2   // data=39
GR 09       // Read SNR 3   // data=48
GR 09       // Read SNR 4 (check byte)   // data=45
</code></pre><blockquote><p>BCC 为校验码，所以上面例子卡的 UID = 7A4E3948</p></blockquote><h3 id=sel---pcd>SEL &lt;- PCD</h3><p>PCD 选择一张卡，发送 <code>0x93 0x70 UID BCC CRC</code></p><blockquote><p>有的芯片设置需要打开 CRC 校验</p></blockquote><pre tabindex=0><code>//&gt; Mifare Select:
SR 0a 80    // flush FIFO
SR 12 80    // TxMode: activate CRC
SR 13 80    // RxMode: activate CRC
SR 09 93    // fast activation of Mifare
SR 09 70    // NVB byte
SR 09 7A    // Write SNR 0
SR 09 4E    // Write SNR 1
SR 09 39    // Write SNR 2
SR 09 48    // Write SNR 3
SR 09 45    // Write SNR 4 (check byte)
SR 0d 80    // BitframingReg - StartSend, TxLastBits
</code></pre><h3 id=picc---sak>PICC -> SAK</h3><p>PICC 确认 PCD 的选择<br>回复格式：SAK + CRC16 (2-byte)<br><img class=lazyload src=/svg/loading.min.svg data-src=/article/2018/05/18/rfid-iso14443a/20180517-sak.png data-srcset="/article/2018/05/18/rfid-iso14443a/20180517-sak.png, /article/2018/05/18/rfid-iso14443a/20180517-sak.png 1.5x, /article/2018/05/18/rfid-iso14443a/20180517-sak.png 2x" data-sizes=auto alt=/article/2018/05/18/rfid-iso14443a/20180517-sak.png title=sak width=252 height=114></p><pre tabindex=0><code>//&gt;         Response SAK:
GR 06       // Read ErrReg
RE 0A 01    // Read FIFOLevel
GR 09       // Read SAK   // data=08 Mifare Classic 1K
</code></pre><blockquote><p>例子中 SAK 回复 0x08，查看芯片手册为 Mifare Classic 1K 卡<br><img class=lazyload src=/svg/loading.min.svg data-src=/article/2018/05/18/rfid-iso14443a/20180517-sak-nxp.png data-srcset="/article/2018/05/18/rfid-iso14443a/20180517-sak-nxp.png, /article/2018/05/18/rfid-iso14443a/20180517-sak-nxp.png 1.5x, /article/2018/05/18/rfid-iso14443a/20180517-sak-nxp.png 2x" data-sizes=auto alt=/article/2018/05/18/rfid-iso14443a/20180517-sak-nxp.png title=sak-nxp width=554 height=404></p></blockquote><h2 id=读写-eeprom>读写 EEPROM</h2><h3 id=mifare1-card>Mifare1 Card</h3><p>Mifare 1 卡片采用 EEPROM 作为存储介质，容量为 1K × 8 位 ，分为 16 个扇区（0<del>15），每个扇区有 4 个块（0</del>3），每块有 16 字节。一个扇区共 16Byte × 4 = 64Byte。扇区的第四块称作尾块，包含了该扇区的密码 A（6个字节）、存取控制（4个字节）、密码 B（6个字节），是控制块。其余三块是数据块。<br><img class=lazyload src=/svg/loading.min.svg data-src=/article/2018/05/18/rfid-iso14443a/20180517-m1.png data-srcset="/article/2018/05/18/rfid-iso14443a/20180517-m1.png, /article/2018/05/18/rfid-iso14443a/20180517-m1.png 1.5x, /article/2018/05/18/rfid-iso14443a/20180517-m1.png 2x" data-sizes=auto alt=/article/2018/05/18/rfid-iso14443a/20180517-m1.png title=m1 width=548 height=575><br>扇区 0 的块 0 固化了厂商代码信息，不可改写。<br>其中：</p><ul><li>第 0~4 字节为卡片的序列号</li><li>第 5 字节为序列号的校验码</li><li>第 6 字节为卡片的容量「SIZE」</li><li>第 7，8 字节为卡片的类型号（Tagtype）</li><li>其他字节由厂商另加定义</li></ul><p>如下图所示：<br><img class=lazyload src=/svg/loading.min.svg data-src=/article/2018/05/18/rfid-iso14443a/20180517-m1-disk.png data-srcset="/article/2018/05/18/rfid-iso14443a/20180517-m1-disk.png, /article/2018/05/18/rfid-iso14443a/20180517-m1-disk.png 1.5x, /article/2018/05/18/rfid-iso14443a/20180517-m1-disk.png 2x" data-sizes=auto alt=/article/2018/05/18/rfid-iso14443a/20180517-m1-disk.png title=m1-disk width=554 height=87></p><h4 id=control-blocks>Control blocks</h4><p>即每个扇区最后一块<br>存储格式如下：<br><img class=lazyload src=/svg/loading.min.svg data-src=/article/2018/05/18/rfid-iso14443a/20180517-ctrl-block.png data-srcset="/article/2018/05/18/rfid-iso14443a/20180517-ctrl-block.png, /article/2018/05/18/rfid-iso14443a/20180517-ctrl-block.png 1.5x, /article/2018/05/18/rfid-iso14443a/20180517-ctrl-block.png 2x" data-sizes=auto alt=/article/2018/05/18/rfid-iso14443a/20180517-ctrl-block.png title=ctrl-block width=549 height=88></p><ul><li>KeyA/B: 读取时返回 0（对 Key 的一种保护吧，默认 Key 一般是 0xFFFFFFFFFFFF），KeyB 不用可做数据字节( 9 字节亦然)</li><li>Access Bit: 控制位，表示扇区各块属性<br><img class=lazyload src=/svg/loading.min.svg data-src=/article/2018/05/18/rfid-iso14443a/20180517-access-bit.png data-srcset="/article/2018/05/18/rfid-iso14443a/20180517-access-bit.png, /article/2018/05/18/rfid-iso14443a/20180517-access-bit.png 1.5x, /article/2018/05/18/rfid-iso14443a/20180517-access-bit.png 2x" data-sizes=auto alt=/article/2018/05/18/rfid-iso14443a/20180517-access-bit.png title=access-bit width=554 height=175><br><img class=lazyload src=/svg/loading.min.svg data-src=/article/2018/05/18/rfid-iso14443a/20180517-access-bit-2.png data-srcset="/article/2018/05/18/rfid-iso14443a/20180517-access-bit-2.png, /article/2018/05/18/rfid-iso14443a/20180517-access-bit-2.png 1.5x, /article/2018/05/18/rfid-iso14443a/20180517-access-bit-2.png 2x" data-sizes=auto alt=/article/2018/05/18/rfid-iso14443a/20180517-access-bit-2.png title=access-bit-2 width=550 height=284></li><li>Byte9：没有实际意义，可当作数据块</li></ul><p>控制块读写权限表如下：<br><img class=lazyload src=/svg/loading.min.svg data-src=/article/2018/05/18/rfid-iso14443a/20180517-access.png data-srcset="/article/2018/05/18/rfid-iso14443a/20180517-access.png, /article/2018/05/18/rfid-iso14443a/20180517-access.png 1.5x, /article/2018/05/18/rfid-iso14443a/20180517-access.png 2x" data-sizes=auto alt=/article/2018/05/18/rfid-iso14443a/20180517-access.png title=access width=554 height=289></p><blockquote><p>图中灰色区域 keyB 可以当作数据区使用<br>修改 access bit 后最好重新认证一下</p></blockquote><h4 id=data-blocks>Data blocks</h4><p>数据块，一般分两类：</p><ol><li>read/write blocks<br>一般用在非接触门禁管理，好像没有特殊格式要求</li><li>value blocks<br>其实应该是 read/write blocks 的特殊类型，一般用在电子钱包，有增值/减值（单独操作命令）<br>存储格式如下图：<br><img class=lazyload src=/svg/loading.min.svg data-src=/article/2018/05/18/rfid-iso14443a/20180517-val.png data-srcset="/article/2018/05/18/rfid-iso14443a/20180517-val.png, /article/2018/05/18/rfid-iso14443a/20180517-val.png 1.5x, /article/2018/05/18/rfid-iso14443a/20180517-val.png 2x" data-sizes=auto alt=/article/2018/05/18/rfid-iso14443a/20180517-val.png title=val width=550 height=83></li></ol><blockquote><p>可操作命令包括 read，write，increment（增值），decrement（减值），restore（恢复），transfer（转移）<br>Vaule 值需要先按照上述格式 write 到存储数据，才能使用增减值等特殊指令操作<br>Adr 是进行备份管理时，用于保存块地址，只能通过 write 命令更改</p></blockquote><p>数据块操作权限表如下：<br><img class=lazyload src=/svg/loading.min.svg data-src=/article/2018/05/18/rfid-iso14443a/20180517-access-data.png data-srcset="/article/2018/05/18/rfid-iso14443a/20180517-access-data.png, /article/2018/05/18/rfid-iso14443a/20180517-access-data.png 1.5x, /article/2018/05/18/rfid-iso14443a/20180517-access-data.png 2x" data-sizes=auto alt=/article/2018/05/18/rfid-iso14443a/20180517-access-data.png title=access-data width=554 height=345></p><blockquote><p>在用于非充值卡的一种情况（001）下，只能够读和减值<br>在另一种情况（110）下，可以用 keyB 充值<br>终极权限下（111）扇区再也不能修改，keyA/B 需要保管好</p></blockquote><h4 id=command>Command</h4><p>M1 卡控制命令，上面都有提到，具体列表如下：<br><img class=lazyload src=/svg/loading.min.svg data-src=/article/2018/05/18/rfid-iso14443a/20180517-cmd.png data-srcset="/article/2018/05/18/rfid-iso14443a/20180517-cmd.png, /article/2018/05/18/rfid-iso14443a/20180517-cmd.png 1.5x, /article/2018/05/18/rfid-iso14443a/20180517-cmd.png 2x" data-sizes=auto alt=/article/2018/05/18/rfid-iso14443a/20180517-cmd.png title=cmd width=554 height=334></p><h3 id=authentication>Authentication</h3><p>M1 卡手册中认证需要如下过程：<br><img class=lazyload src=/svg/loading.min.svg data-src=/article/2018/05/18/rfid-iso14443a/20180517-auth-1.png data-srcset="/article/2018/05/18/rfid-iso14443a/20180517-auth-1.png, /article/2018/05/18/rfid-iso14443a/20180517-auth-1.png 1.5x, /article/2018/05/18/rfid-iso14443a/20180517-auth-1.png 2x" data-sizes=auto alt=/article/2018/05/18/rfid-iso14443a/20180517-auth-1.png title=auth-1 width=552 height=234><br><img class=lazyload src=/svg/loading.min.svg data-src=/article/2018/05/18/rfid-iso14443a/20180517-auth-2.png data-srcset="/article/2018/05/18/rfid-iso14443a/20180517-auth-2.png, /article/2018/05/18/rfid-iso14443a/20180517-auth-2.png 1.5x, /article/2018/05/18/rfid-iso14443a/20180517-auth-2.png 2x" data-sizes=auto alt=/article/2018/05/18/rfid-iso14443a/20180517-auth-2.png title=auth-2 width=546 height=233><br>命令表示如下：<br><img class=lazyload src=/svg/loading.min.svg data-src=/article/2018/05/18/rfid-iso14443a/20180517-auth-cmd.png data-srcset="/article/2018/05/18/rfid-iso14443a/20180517-auth-cmd.png, /article/2018/05/18/rfid-iso14443a/20180517-auth-cmd.png 1.5x, /article/2018/05/18/rfid-iso14443a/20180517-auth-cmd.png 2x" data-sizes=auto alt=/article/2018/05/18/rfid-iso14443a/20180517-auth-cmd.png title=auth-cmd width=554 height=207><br>不过这部分其实还是要看读卡器怎么设置，PN512 手册里面要求如下：<br><img class=lazyload src=/svg/loading.min.svg data-src=/article/2018/05/18/rfid-iso14443a/20180517-auth.png data-srcset="/article/2018/05/18/rfid-iso14443a/20180517-auth.png, /article/2018/05/18/rfid-iso14443a/20180517-auth.png 1.5x, /article/2018/05/18/rfid-iso14443a/20180517-auth.png 2x" data-sizes=auto alt=/article/2018/05/18/rfid-iso14443a/20180517-auth.png title=auth width=308 height=321><br>即在 FIFO 写入 <code>60/61 + addr + keyA/B(6byte) + UID(4byte)</code> + <code>CRC</code><br>判断认证结果：</p><ul><li>成功：<code>Status2 Reg[3]=1</code></li><li>失败：<code>Status2 Reg[3]=0</code></li></ul><h3 id=read>Read</h3><p>时序图：<br><img class=lazyload src=/svg/loading.min.svg data-src=/article/2018/05/18/rfid-iso14443a/20180517-read.png data-srcset="/article/2018/05/18/rfid-iso14443a/20180517-read.png, /article/2018/05/18/rfid-iso14443a/20180517-read.png 1.5x, /article/2018/05/18/rfid-iso14443a/20180517-read.png 2x" data-sizes=auto alt=/article/2018/05/18/rfid-iso14443a/20180517-read.png title=read width=550 height=527><br>PN512：<br>发送：<code>30 + addr</code> + <code>CRC</code><br>接收：<code>data(16byte)</code> + <code>CRC</code></p><h3 id=write>Write</h3><p>时序图：<br><img class=lazyload src=/svg/loading.min.svg data-src=/article/2018/05/18/rfid-iso14443a/20180517-write-1.png data-srcset="/article/2018/05/18/rfid-iso14443a/20180517-write-1.png, /article/2018/05/18/rfid-iso14443a/20180517-write-1.png 1.5x, /article/2018/05/18/rfid-iso14443a/20180517-write-1.png 2x" data-sizes=auto alt=/article/2018/05/18/rfid-iso14443a/20180517-write-1.png title=write-1 width=523 height=233><br><img class=lazyload src=/svg/loading.min.svg data-src=/article/2018/05/18/rfid-iso14443a/20180517-write-2.png data-srcset="/article/2018/05/18/rfid-iso14443a/20180517-write-2.png, /article/2018/05/18/rfid-iso14443a/20180517-write-2.png 1.5x, /article/2018/05/18/rfid-iso14443a/20180517-write-2.png 2x" data-sizes=auto alt=/article/2018/05/18/rfid-iso14443a/20180517-write-2.png title=write-2 width=524 height=234><br><img class=lazyload src=/svg/loading.min.svg data-src=/article/2018/05/18/rfid-iso14443a/20180517-write-3.png data-srcset="/article/2018/05/18/rfid-iso14443a/20180517-write-3.png, /article/2018/05/18/rfid-iso14443a/20180517-write-3.png 1.5x, /article/2018/05/18/rfid-iso14443a/20180517-write-3.png 2x" data-sizes=auto alt=/article/2018/05/18/rfid-iso14443a/20180517-write-3.png title=write-3 width=539 height=162><br><img class=lazyload src=/svg/loading.min.svg data-src=/article/2018/05/18/rfid-iso14443a/20180517-write-4.png data-srcset="/article/2018/05/18/rfid-iso14443a/20180517-write-4.png, /article/2018/05/18/rfid-iso14443a/20180517-write-4.png 1.5x, /article/2018/05/18/rfid-iso14443a/20180517-write-4.png 2x" data-sizes=auto alt=/article/2018/05/18/rfid-iso14443a/20180517-write-4.png title=write-4 width=553 height=98><br>PN512：<br>发送: <code>A0 + addr</code> + <code>CRC</code><br>接收: <code>ACK(A0)/NAK/timeout(5ms)</code> + <strong><code>NO CRC</code></strong><br>发送: <code>data(16byte)</code> + <code>CRC</code><br>接收: <code>ACK(A0)/NAK/timeout(10ms)</code> + <strong><code>NO CRC</code></strong></p><h3 id=other>Other</h3><p>Increment & Decrement & Restore & Transfer 这些命令也像上面一样对照着 M1 卡手册和 PN512 手册查看，这里不再赘述了。</p><h2 id=总结>总结</h2><p>当初看 RFID 怎么读写时特别困惑，因为读卡器手册上只有寄存器表示什么，没有说里面值要填什么值。<br>后来看了 M1 手册和例子才知道，哦，原来这个协议就是这么规定的。<br>所以有时理解标准协议不如看看相关芯片手册，也许会有惊喜。</p></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span>更新于 2018-05-18</span></div></div><div class=post-info-line><div class=post-info-md></div><div class=post-info-share><span><a href=javascript:void(0); title="分享到 Facebook" data-sharer=facebook data-url=https://wishlily.github.io/article/2018/05/18/rfid-iso14443a/ data-hashtag=rfid><i class="fab fa-facebook-square fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="分享到 Hacker News" data-sharer=hackernews data-url=https://wishlily.github.io/article/2018/05/18/rfid-iso14443a/ data-title=RFID：ISO14443A><i class="fab fa-hacker-news fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="分享到 Reddit" data-sharer=reddit data-url=https://wishlily.github.io/article/2018/05/18/rfid-iso14443a/><i class="fab fa-reddit fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="分享到 Line" data-sharer=line data-url=https://wishlily.github.io/article/2018/05/18/rfid-iso14443a/ data-title=RFID：ISO14443A><i data-svg-src=https://cdn.jsdelivr.net/npm/simple-icons@7.3.0/icons/line.svg aria-hidden=true></i></a><a href=javascript:void(0); title="分享到 微博" data-sharer=weibo data-url=https://wishlily.github.io/article/2018/05/18/rfid-iso14443a/ data-title=RFID：ISO14443A><i class="fab fa-weibo fa-fw" aria-hidden=true></i></a></span></div></div></div><div class=post-info-more><section class=post-tags><i class="fas fa-tags fa-fw" aria-hidden=true></i>&nbsp;<a href=/tags/rfid/>Rfid</a>,&nbsp;<a href=/tags/pn512/>Pn512</a>,&nbsp;<a href=/tags/m1/>M1</a></section><section><span><a href=javascript:void(0); onclick=window.history.back()>返回</a></span>&nbsp;|&nbsp;<span><a href=/>主页</a></span></section></div><div class=post-nav><a href=/article/2018/05/15/figure-bed/ class=prev rel=prev title=博客图床><i class="fas fa-angle-left fa-fw" aria-hidden=true></i>博客图床</a>
<a href=/article/2018/09/29/react-component-communication/ class=next rel=next title="react 组件通信">react 组件通信<i class="fas fa-angle-right fa-fw" aria-hidden=true></i></a></div></div><div id=comments><div id=giscus class=comment></div><noscript>Please enable JavaScript to view the comments powered by <a href=https://giscus.app>Giscus</a>.</noscript></div></article></div></main><footer class=footer><div class=footer-container><div class=footer-line>由 <a href=https://gohugo.io/ target=_blank rel="noopener noreffer" title="Hugo 0.145.0">Hugo</a> 强力驱动 | 主题 - <a href=https://github.com/dillonzq/LoveIt target=_blank rel="noopener noreffer" title="LoveIt 0.3.0"><i class="far fa-kiss-wink-heart fa-fw" aria-hidden=true></i> LoveIt</a></div><div class=footer-line itemscope itemtype=http://schema.org/CreativeWork><i class="far fa-copyright fa-fw" aria-hidden=true></i><span itemprop=copyrightYear>2015 - 2025</span><span class=author itemprop=copyrightHolder>&nbsp;<a href=/ target=_blank>Wishlily</a></span>&nbsp;|&nbsp;<span class=license><a rel="license external nofollow noopener noreffer" href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank>CC BY-NC 4.0</a></span></div></div></footer></div><div id=fixed-buttons><a href=# id=back-to-top class=fixed-button title=回到顶部><i class="fas fa-arrow-up fa-fw" aria-hidden=true></i>
</a><a href=# id=view-comments class=fixed-button title=查看评论><i class="fas fa-comment fa-fw" aria-hidden=true></i></a></div><script type=text/javascript src=https://cdn.jsdelivr.net/npm/autocomplete.js@0.38.1/dist/autocomplete.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/lunr@2.3.9/lunr.min.js></script><script type=text/javascript src=/lib/lunr/lunr.stemmer.support.min.js></script><script type=text/javascript src=/lib/lunr/lunr.zh.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/lazysizes@5.3.2/lazysizes.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/clipboard@2.0.11/dist/clipboard.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/sharer.js@0.5.1/sharer.min.js></script><script type=text/javascript>window.config={code:{copyTitle:"复制到剪贴板",maxShownLines:50},comment:{giscus:{category:"Q&A",categoryId:"DIC_kwDODuSf184Ct4tE",darkTheme:"dark",emitMetadata:"0",inputPosition:"top",lang:"zh-CN",lazyLoading:!0,lightTheme:"light",mapping:"pathname",reactionsEnabled:"1",repo:"wishlily/wishlily.github.io",repoId:"MDEwOlJlcG9zaXRvcnkyNDk4NjQxNTE="}},search:{highlightTag:"em",lunrIndexURL:"/index.json",lunrLanguageCode:"zh",lunrSegmentitURL:"/lib/lunr/lunr.segmentit.js",maxResultLength:10,noResultsFound:"没有找到结果",snippetLength:50,type:"lunr"}}</script><script type=text/javascript src=/js/theme.min.js></script><script type=text/javascript>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-R4ZHVCJLGY",{anonymize_ip:!0})</script><script type=text/javascript src="https://www.googletagmanager.com/gtag/js?id=G-R4ZHVCJLGY" async></script></body></html>